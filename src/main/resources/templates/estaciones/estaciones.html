<!DOCTYPE html>
<html lang="es">
<div th:replace="~{compartidos/head :: head()}"></div>
<style>

    /*filtros*/
    .floating-filters {
        position: fixed;
        left: 0;
        bottom: 0;
        width: 100vw;
        z-index: 1000;
        background: #fff;
        box-shadow: 0 6px 32px rgba(0,0,0,0.10);
        padding: 18px 0 10px 0;
        display: flex;
        justify-content: center;
    }
    .floating-filters-row {
        display: flex;
        flex-direction: row;
        gap: 38px;
        width: 100%;
        max-width: 1100px;
        justify-content: center;
        align-items: flex-end;
    }
    .section-block {
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        min-width: 180px;
    }
    .boton-block {
        align-items: center !important;
        justify-content: flex-end !important;
        min-width: 90px;
    }
    .section-title {
        font-size: 1rem;
        font-weight: 500;
        margin-bottom: 0.5rem;
        font-family: 'Roboto', Arial, sans-serif;
    }
    .chip-checkbox-group {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        margin-bottom: 0.5rem;
    }
    .chip-item input[type="checkbox"] {
        display: none;
    }
    .chip-checkbox-group label {
        display: inline-flex;
        align-items: center;
        height: 24px;
        padding: 0 10px;
        font-size: 12px;
        font-weight: 500;
        font-family: 'Roboto', sans-serif;
        border-radius: 7px;
        border: 0.5px solid #a7aca7;
        color: #49454F;
        background-color: #FFFFFF;
        cursor: pointer;
        transition: background-color 0.2s, color 0.2s;
        user-select: none;
    }
    .chip-checkbox-group label:hover {
        background-color: #F7F2FA;
    }
    .chip-item input[type="checkbox"]:checked ~ label {
        background-color: #bccfa1;
        color: #1a2516;
        border-color: transparent;
    }
    .boton {
        display: flex;
        align-items: center;
        justify-content: center;
        background: #345700FF;
        color: white;
        border: none;
        border-radius: 999px;
        height: 34px;
        width: 60px;
        cursor: pointer;
        transition: background 0.2s;
        margin-left: 18px;
        margin-bottom: 0.5rem;
    }
    .boton svg {
        width: 20px;
        height: 20px;
        color: white;
    }
    .mensajito {
        margin-top: -0.2rem;
        margin-bottom: 0.5rem;
        font-size: 0.8rem;
        color: #4a5568;
    }
    @media (max-width: 700px) {
        .floating-filters-row {
            flex-direction: column;
            align-items: stretch;
            gap: 8px;
        }
        .section-block {
            min-width: 0;
        }
    }

    /* estaciones y tren */

    body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 20px;
    }
    .container {
        max-width: 1300px;
        margin: 0 auto;
        padding: 30px;
    }
   #pie-fondo-emergente{
        position: absolute;
        bottom: 20px;
    }
    .ubi-tren{
        position: absolute;
        right: 12px;
        top: 12px;
        display: none;
    }
    #ssp{
        position: absolute;
        right: 100px;
        top: 200px;
        display: none;
    }
    .eleccion-card {
        background: white;
        border-radius: 12px;
        padding: 25px;
        width: 400px;        /* Ancho fijo - MODIFICAR AQUÍ */
        height: 340px;       /* Alto fijo - MODIFICAR AQUÍ */
        position: fixed;
        bottom: 160px;
        right: 20px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        border: 1px solid #e0e0e0;
        display: none; /* Inicialmente oculta */
        animation: slideInRight 0.3s ease-out;
        z-index: 100;
    }
    .eleccion-card2 {
        background: white;
        border-radius: 12px;
        padding: 25px;
        width: 120px;        /* Ancho fijo - MODIFICAR AQUÍ */
        height: 28px;       /* Alto fijo - MODIFICAR AQUÍ */
        position: fixed;
        bottom: 100px;
        right: 20px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        border: 1px solid #e0e0e0;
        display: none; /* Inicialmente oculta */
        animation: slideInRight 0.3s ease-out;
        z-index: 100;
    }
    .close-btn {
        position: absolute;
        top: 10px;
        right: 10px;
        background: #ef4444;
        color: white;
        border: none;
        width: 25px;
        height: 25px;
        border-radius: 50%;
        cursor: pointer;
        font-size: 14px;
        font-weight: bold;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: background-color 0.2s ease;
    }
    .close-btn:hover {
        background: #dc2626;
    }
    #btnPDF{
        position: absolute;
        top: 190px;
        right: 40px;
        width: 80px;
        height: 32px;
        border-radius: 6%;
    }
    .card-content {
        margin-top: 10px;
    }
    .card-label {
        font-size: 16px;
        font-weight: 600;
        color: #333;
        margin-bottom: 20px;
        display: block;
    }
    @keyframes slideInRight {
        from {
            opacity: 0;
            transform: translateX(100%);
        }
        to {
            opacity: 1;
            transform: translateX(0);
        }
    }
    .main-buttons {
        display: flex;
        flex-direction: row;      /* Elementos en fila */
        align-items: center;      /* Centrado vertical */
        justify-content: center;  /* Centrado horizontal */
        gap: 25px;
        /*margin-bottom: 40px;*/
    }
    .conte {
        position: relative;  /* Clave para que los hijos absolutos se posicionen dentro */
        width: 100%;
        height: 100px; /* ajusta según tu diseño */
    }
    .stations-grid {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 20px;
        margin: 40px 0;
    }
    .station-card {
        background: white;
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        border: 1px solid #e5e7eb;
        transition: transform 0.2s, box-shadow 0.2s;
    }
    .station-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
    }
    .station-name {
        font-size: 18px;
        font-weight: 600;
        color: #1f2937;
        margin-bottom: 15px;
    }
    .station-card {
        position: relative;
    }
    .station-card button {
        background-color: #345700FF;
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 6px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        position: absolute;
        bottom: 10px;
        right: 10px;
        transition: background-color 0.2s ease;
    }
    .station-card button:hover {
        background-color: #253d01;
    }
    .station-card button:active {
        background-color: #345700FF;
        transform: translateY(1px);
    }
    @media (max-width: 1024px) {
        .stations-grid {
            grid-template-columns: repeat(4, 1fr);
        }
    }
    @media (max-width: 768px) {
        .stations-grid {
            grid-template-columns: repeat(2, 1fr);
        }
    }
    @media (max-width: 480px) {
        .stations-grid {
            grid-template-columns: 1fr;
        }
    }
    .weather-info,
    .passenger-info {
        display: flex;
        align-items: center;
        gap: 8px;
        justify-content: flex-start;
    }
    .weather-icon,
    .passenger-icon {
        display: flex;
        align-items: center;
        justify-content: center;
        /*min-width: 24px;   !* Asegura ancho fijo para alineación vertical *!*/
        /*min-height: 24px;  !* Asegura alto fijo para alineación vertical *!*/
        width: 42px;
        height: 42px;
    }
    .weather-icon img {
        width: 42px;
        height: 42px;
        display: block;
    }
    .weather-icon-texto {
        margin-left: 0;
    }
    .station-card .passenger-info label {
        margin-left: 8px; /* igual que gap: 8px arriba, por si acaso */
    }
    .pasaje {
        font-weight: bold;
    }
    .mensajes {
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 3rem;
        gap: 2rem;
    }
    .salida {
        font-weight: bold;
    }

</style>
<body>
<div th:replace="~{compartidos/header :: header()}"></div>

<!--estaciones y tren-->
<div class="container">
    <p class="mensajes">
        <span class="pasaje">Pasaje:</span> S/1.50
        <span class="salida">Primera salida del tren:</span>07AM
        <span class="salida">Última salida del tren:</span>08PM
    </p>
    <div class="stations-grid">

        <div  class="station-card"  >
            <div class="station-name"   th:onclick="'window.location.href=\'/estaciones/' + ${esta.get(0).getIdEstacion()} + '\';'"><label th:text="${esta.get(0).getNombre()}"></label>
                <img class="ubi-tren"  id="u1" th:src="@{/icons/iconos/circulo2.svg}" width="12" height="12" alt="detalleIcon"></div>
            <div class="weather-info"  id="t0"  th:onclick="'window.location.href=\'/estaciones/' + ${esta.get(0).getIdEstacion()} + '\';'">
                <img th:src="@{${estaciones.get(0).getIcono()}}" alt="climaicono" class="weather-icon">
                <label th:text="${esta.get(0).getTemperatura()}" class="weather-icon-texto"></label></div>
            <div class="passenger-info"  th:onclick="'window.location.href=\'/estaciones/' + ${esta.get(0).getIdEstacion()} + '\';'">
                <div class="passenger-icon"><svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#787F6C"><path d="m40-240 240-320 180 240h300L560-586 460-454l-50-66 150-200 360 480H40Zm521-80Zm-361 0h160l-80-107-80 107Zm0 0h160-160Z"/></svg></div>
                <label th:text="${esta.get(0).getNroZonasTuristicas()}"></label></div>

            <div class="passenger-info"> <br><br>
                <button onclick="eleccion(0)" > Elegir destino </button>
            </div>
        </div>

        <div class="station-card" >
            <div class="station-name"  th:onclick="'window.location.href=\'/estaciones/' + ${esta.get(1).getIdEstacion()} + '\';'" ><label th:text="${esta.get(1).getNombre()}"></label>
                <img class="ubi-tren"  id="u2" th:src="@{/icons/iconos/circulo2.svg}" width="12" height="12" alt="detalleIcon"></div>
            <div class="weather-info"  id="t1"  th:onclick="'window.location.href=\'/estaciones/' + ${esta.get(1).getIdEstacion()} + '\';'" >
                <img th:src="@{${estaciones.get(1).getIcono()}}" alt="climaicono" class="weather-icon">
                <label th:text="${esta.get(1).getTemperatura()}"></label></div>
            <div class="passenger-info" th:onclick="'window.location.href=\'/estaciones/' + ${esta.get(1).getIdEstacion()} + '\';'">
                <div class="passenger-icon"><svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#787F6C"><path d="m40-240 240-320 180 240h300L560-586 460-454l-50-66 150-200 360 480H40Zm521-80Zm-361 0h160l-80-107-80 107Zm0 0h160-160Z"/></svg></div>
                <label th:text="${esta.get(1).getNroZonasTuristicas()}"></label></div>

            <div class="passenger-info"> <br><br>
                <button onclick="eleccion(1)" > Elegir destino </button>
            </div>
        </div>

        <div class="station-card"  >
            <div class="station-name"  th:onclick="'window.location.href=\'/estaciones/' + ${esta.get(2).getIdEstacion()} + '\';'"><label th:text="${esta.get(2).getNombre()}"></label>
                <img class="ubi-tren"  id="u3" th:src="@{/icons/iconos/circulo2.svg}" width="12" height="12" alt="detalleIcon"></div>
            <div class="weather-info"  id="t2"  th:onclick="'window.location.href=\'/estaciones/' + ${esta.get(2).getIdEstacion()} + '\';'">
                <img th:src="@{${estaciones.get(2).getIcono()}}" alt="climaicono" class="weather-icon">
                <label th:text="${esta.get(2).getTemperatura()}"></label></div>
            <div class="passenger-info" th:onclick="'window.location.href=\'/estaciones/' + ${esta.get(2).getIdEstacion()} + '\';'">
                <div class="passenger-icon"><svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" ><path d="m40-240 240-320 180 240h300L560-586 460-454l-50-66 150-200 360 480H40Zm521-80Zm-361 0h160l-80-107-80 107Zm0 0h160-160Z"/></svg></div>
                <label th:text="${esta.get(2).getNroZonasTuristicas()}"></label></div>

            <div class="passenger-info"> <br><br>
                <button onclick="eleccion(2)" > Elegir destino </button>
            </div>
        </div>
        <div class="station-card"  >
            <div class="station-name"  th:onclick="'window.location.href=\'/estaciones/' + ${esta.get(3).getIdEstacion()} + '\';'" ><label th:text="${esta.get(3).getNombre()}"></label>
                <img class="ubi-tren"  id="u4" th:src="@{/icons/iconos/circulo2.svg}" width="12" height="12" alt="detalleIcon"></div>
            <div class="weather-info"  id="t3" th:onclick="'window.location.href=\'/estaciones/' + ${esta.get(3).getIdEstacion()} + '\';'" >
                <img th:src="@{${estaciones.get(3).getIcono()}}" alt="climaicono" class="weather-icon">
                <label th:text="${esta.get(3).getTemperatura()}"></label></div>
            <div class="passenger-info" th:onclick="'window.location.href=\'/estaciones/' + ${esta.get(3).getIdEstacion()} + '\';'">
                <div class="passenger-icon"><svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" ><path d="m40-240 240-320 180 240h300L560-586 460-454l-50-66 150-200 360 480H40Zm521-80Zm-361 0h160l-80-107-80 107Zm0 0h160-160Z"/></svg></div>
                <label th:text="${esta.get(3).getNroZonasTuristicas()}"></label></div>

            <div class="passenger-info"> <br><br>
                <button onclick="eleccion(3)" > Elegir destino </button>
            </div>
        </div>

        <div class="station-card"  >
            <div class="station-name" th:onclick="'window.location.href=\'/estaciones/' + ${esta.get(4).getIdEstacion()} + '\';'" ><label th:text="${esta.get(4).getNombre()}"></label>
                <img class="ubi-tren"  id="u5" th:src="@{/icons/iconos/circulo2.svg}" width="12" height="12" alt="detalleIcon"></div>
            <div class="weather-info"  id="t4" th:onclick="'window.location.href=\'/estaciones/' + ${esta.get(4).getIdEstacion()} + '\';'" >
                <img th:src="@{${estaciones.get(4).getIcono()}}" alt="climaicono" class="weather-icon">
                <label th:text="${esta.get(4).getTemperatura()}"></label></div>
            <div class="passenger-info" th:onclick="'window.location.href=\'/estaciones/' + ${esta.get(4).getIdEstacion()} + '\';'" >
                <div class="passenger-icon"><svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#787F6C"><path d="m40-240 240-320 180 240h300L560-586 460-454l-50-66 150-200 360 480H40Zm521-80Zm-361 0h160l-80-107-80 107Zm0 0h160-160Z"/></svg></div>
                <label th:text="${esta.get(4).getNroZonasTuristicas()}"></label></div>

            <div class="passenger-info"> <br><br>
                <button onclick="eleccion(4)" > Elegir destino </button>
            </div>
        </div>

        <div class="station-card"   >
            <div class="station-name"  th:onclick="'window.location.href=\'/estaciones/' + ${esta.get(5).getIdEstacion()} + '\';'"><label th:text="${esta.get(5).getNombre()}"></label>
                <img class="ubi-tren"  id="u6" th:src="@{/icons/iconos/circulo2.svg}" width="12" height="12" alt="detalleIcon"></div>
            <div class="weather-info"    id="t5" th:onclick="'window.location.href=\'/estaciones/' + ${esta.get(5).getIdEstacion()} + '\';'">
                <img th:src="@{${estaciones.get(5).getIcono()}}" alt="climaicono" class="weather-icon">
                <label th:text="${esta.get(5).getTemperatura()}"></label></div>
            <div class="passenger-info"  th:onclick="'window.location.href=\'/estaciones/' + ${esta.get(5).getIdEstacion()} + '\';'" >
                <div class="passenger-icon"><svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#787F6C"><path d="m40-240 240-320 180 240h300L560-586 460-454l-50-66 150-200 360 480H40Zm521-80Zm-361 0h160l-80-107-80 107Zm0 0h160-160Z"/></svg></div>
                <label th:text="${esta.get(5).getNroZonasTuristicas()}"></label></div>

            <div class="passenger-info"> <br><br>
                <button onclick="eleccion(5)" > Elegir destino </button>
            </div>
        </div>
        <div class="station-card"   >
            <div class="station-name"  th:onclick="'window.location.href=\'/estaciones/' + ${esta.get(6).getIdEstacion()} + '\';'"><label th:text="${esta.get(6).getNombre()}"></label>
                <img class="ubi-tren"  id="u7" th:src="@{/icons/iconos/circulo2.svg}" width="12" height="12" alt="detalleIcon"></div>
            <div class="weather-info"  id="t6" th:onclick="'window.location.href=\'/estaciones/' + ${esta.get(6).getIdEstacion()} + '\';'">
                <img th:src="@{${estaciones.get(6).getIcono()}}" alt="climaicono" class="weather-icon">
                <label th:text="${esta.get(6).getTemperatura()}"></label></div>
            <div class="passenger-info"  th:onclick="'window.location.href=\'/estaciones/' + ${esta.get(6).getIdEstacion()} + '\';'">
                <div class="passenger-icon"><svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#787F6C"><path d="m40-240 240-320 180 240h300L560-586 460-454l-50-66 150-200 360 480H40Zm521-80Zm-361 0h160l-80-107-80 107Zm0 0h160-160Z"/></svg></div>
                <label th:text="${esta.get(6).getNroZonasTuristicas()}"></label></div>

            <div class="passenger-info"> <br><br>
                <button onclick="eleccion(6)" > Elegir destino </button>
            </div>
        </div>
    </div>


    <!-- 14 Botones principales en fila -->
    <div class="conte">
        <div class="main-buttons " id="mainButtons">

            <a th:onclick="mainAction(1)"><img id="1" th:src="@{/icons/iconos/circulo.svg}" width="50" height="50" alt="detalleIcon"></a>
            <a th:onclick="mainAction(2)"><img id="2" th:src="@{/icons/iconos/circulo.svg}" width="50" height="50" alt="detalleIcon"></a>
            <a th:onclick="mainAction(3)"><img id="3" th:src="@{/icons/iconos/circulo.svg}" width="50" height="50" alt="detalleIcon"></a>
            <a th:onclick="mainAction(4)"><img id="4" th:src="@{/icons/iconos/circulo.svg}" width="50" height="50" alt="detalleIcon"></a>
            <a th:onclick="mainAction(5)"><img id="5" th:src="@{/icons/iconos/circulo.svg}" width="50" height="50" alt="detalleIcon"></a>
            <a th:onclick="mainAction(6)"><img id="6" th:src="@{/icons/iconos/circulo.svg}" width="50" height="50" alt="detalleIcon"></a>
            <a th:onclick="mainAction(7)"><img id="7" th:src="@{/icons/iconos/circulo.svg}" width="50" height="50" alt="detalleIcon"></a>
            <a th:onclick="mainAction(8)"><img id="8" th:src="@{/icons/iconos/circulo.svg}" width="50" height="50" alt="detalleIcon"></a>
            <a th:onclick="mainAction(9)"><img id="9" th:src="@{/icons/iconos/circulo.svg}" width="50" height="50" alt="detalleIcon"></a>
            <a th:onclick="mainAction(10)"><img id="10" th:src="@{/icons/iconos/circulo.svg}" width="50" height="50" alt="detalleIcon"></a>
            <a th:onclick="mainAction(11)"><img id="11" th:src="@{/icons/iconos/circulo.svg}" width="50" height="50" alt="detalleIcon"></a>
            <a th:onclick="mainAction(12)"><img id="12" th:src="@{/icons/iconos/circulo.svg}" width="50" height="50" alt="detalleIcon"></a>
            <a th:onclick="mainAction(13)"><img id="13" th:src="@{/icons/iconos/circulo.svg}" width="50" height="50" alt="detalleIcon"></a>
            <a th:onclick="mainAction(14)"><img id="14" th:src="@{/icons/iconos/circulo.svg}" width="50" height="50" alt="detalleIcon"></a>



        </div>
        <div style="position: relative; width: 100%; height: 50px;">

            <img id="personIcon" th:src="@{/icons/iconos/person.png}" width="30" alt="person" style="position: absolute;">
        </div>
    </div>



    <div class="stations-grid">

        <div class="station-card"  >
            <div class="station-name"   th:onclick="'window.location.href=\'/estaciones/' + ${esta.get(7).getIdEstacion()} + '\';'"><label th:text="${esta.get(7).getNombre()}"></label>
                <img class="ubi-tren"  id="u8" th:src="@{/icons/iconos/circulo2.svg}" width="12" height="12" alt="detalleIcon"></div>
            <div class="weather-info"  id="t7" th:onclick="'window.location.href=\'/estaciones/' + ${esta.get(7).getIdEstacion()} + '\';'">
                <img th:src="@{${estaciones.get(7).getIcono()}}" alt="climaicono" class="weather-icon">
                <label th:text="${esta.get(7).getTemperatura()}"></label></div>
            <div class="passenger-info"   th:onclick="'window.location.href=\'/estaciones/' + ${esta.get(7).getIdEstacion()} + '\';'">
                <div class="passenger-icon"><svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#787F6C"><path d="m40-240 240-320 180 240h300L560-586 460-454l-50-66 150-200 360 480H40Zm521-80Zm-361 0h160l-80-107-80 107Zm0 0h160-160Z"/></svg></div>
                <label th:text="${esta.get(7).getNroZonasTuristicas()}"></label></div>

            <div class="passenger-info"> <br><br>
                <button onclick="eleccion(7)" > Elegir destino </button>
            </div>
        </div>

        <div class="station-card"   >
            <div class="station-name" th:onclick="'window.location.href=\'/estaciones/' + ${esta.get(8).getIdEstacion()} + '\';'"><label th:text="${esta.get(8).getNombre()}"></label>
                <img class="ubi-tren"  id="u9" th:src="@{/icons/iconos/circulo2.svg}" width="12" height="12" alt="detalleIcon"></div>
            <div class="weather-info"  id="t8" th:onclick="'window.location.href=\'/estaciones/' + ${esta.get(8).getIdEstacion()} + '\';'">
                <img th:src="@{${estaciones.get(8).getIcono()}}" alt="climaicono" class="weather-icon">
                <label th:text="${esta.get(8).getTemperatura()}"></label></div>
            <div class="passenger-info" th:onclick="'window.location.href=\'/estaciones/' + ${esta.get(8).getIdEstacion()} + '\';'">
                <div class="passenger-icon"><svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#787F6C"><path d="m40-240 240-320 180 240h300L560-586 460-454l-50-66 150-200 360 480H40Zm521-80Zm-361 0h160l-80-107-80 107Zm0 0h160-160Z"/></svg></div>
                <label th:text="${esta.get(8).getNroZonasTuristicas()}"></label></div>

            <div class="passenger-info"> <br><br>
                <button onclick="eleccion(8)" > Elegir destino </button>
            </div>
        </div>

        <div class="station-card"   >
            <div class="station-name" th:onclick="'window.location.href=\'/estaciones/' + ${esta.get(9).getIdEstacion()} + '\';'"><label th:text="${esta.get(9).getNombre()}"></label>
                <img class="ubi-tren"  id="u10" th:src="@{/icons/iconos/circulo2.svg}" width="12" height="12" alt="detalleIcon"></div>
            <div class="weather-info" id="t9" th:onclick="'window.location.href=\'/estaciones/' + ${esta.get(9).getIdEstacion()} + '\';'">
                <img th:src="@{${estaciones.get(9).getIcono()}}" alt="climaicono" class="weather-icon">
                <label th:text="${esta.get(9).getTemperatura()}"></label></div>
            <div class="passenger-info" th:onclick="'window.location.href=\'/estaciones/' + ${esta.get(9).getIdEstacion()} + '\';'">
                <div class="passenger-icon"><svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#787F6C"><path d="m40-240 240-320 180 240h300L560-586 460-454l-50-66 150-200 360 480H40Zm521-80Zm-361 0h160l-80-107-80 107Zm0 0h160-160Z"/></svg></div>
                <label th:text="${esta.get(9).getNroZonasTuristicas()}"></label></div>

            <div class="passenger-info"> <br><br>
                <button onclick="eleccion(9)" > Elegir destino </button>
            </div>
        </div>
        <div class="station-card" >
            <div class="station-name"  th:onclick="'window.location.href=\'/estaciones/' + ${esta.get(10).getIdEstacion()} + '\';'" ><label th:text="${esta.get(10).getNombre()}"></label>
                <img class="ubi-tren"  id="u11" th:src="@{/icons/iconos/circulo2.svg}" width="12" height="12" alt="detalleIcon"></div>
            <div class="weather-info"  id="t10"  th:onclick="'window.location.href=\'/estaciones/' + ${esta.get(10).getIdEstacion()} + '\';'" >
                <img th:src="@{${estaciones.get(10).getIcono()}}" alt="climaicono" class="weather-icon">
                <label th:text="${esta.get(10).getTemperatura()}"></label></div>
            <div class="passenger-info"   th:onclick="'window.location.href=\'/estaciones/' + ${esta.get(10).getIdEstacion()} + '\';'" >
                <div class="passenger-icon"><svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#787F6C"><path d="m40-240 240-320 180 240h300L560-586 460-454l-50-66 150-200 360 480H40Zm521-80Zm-361 0h160l-80-107-80 107Zm0 0h160-160Z"/></svg></div>
                <label th:text="${esta.get(10).getNroZonasTuristicas()}"></label></div>

            <div class="passenger-info"> <br><br>
                <button onclick="eleccion(10)" > Elegir destino </button>
            </div>
        </div>

        <div class="station-card"   >
            <div class="station-name" th:onclick="'window.location.href=\'/estaciones/' + ${esta.get(11).getIdEstacion()} + '\';'"><label th:text="${esta.get(11).getNombre()}"></label>
                <img class="ubi-tren"  id="u12" th:src="@{/icons/iconos/circulo2.svg}" width="12" height="12" alt="detalleIcon"></div>
            <div class="weather-info"  id="t11"th:onclick="'window.location.href=\'/estaciones/' + ${esta.get(11).getIdEstacion()} + '\';'">
                <img th:src="@{${estaciones.get(11).getIcono()}}" alt="climaicono" class="weather-icon">
                <label th:text="${esta.get(11).getTemperatura()}"></label></div>
            <div class="passenger-info" th:onclick="'window.location.href=\'/estaciones/' + ${esta.get(11).getIdEstacion()} + '\';'">
                <div class="passenger-icon"><svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#787F6C"><path d="m40-240 240-320 180 240h300L560-586 460-454l-50-66 150-200 360 480H40Zm521-80Zm-361 0h160l-80-107-80 107Zm0 0h160-160Z"/></svg></div>
                <label th:text="${esta.get(11).getNroZonasTuristicas()}"></label></div>

            <div class="passenger-info"> <br><br>
                <button onclick="eleccion(11)" > Elegir destino </button>
            </div>
        </div>

        <div class="station-card"  >
            <div class="station-name"  th:onclick="'window.location.href=\'/estaciones/' + ${esta.get(12).getIdEstacion()} + '\';'"><label th:text="${esta.get(12).getNombre()}"></label>
                <img class="ubi-tren"  id="u13" th:src="@{/icons/iconos/circulo2.svg}" width="12" height="12" alt="detalleIcon"></div>
            <div class="weather-info"   id="t12" th:onclick="'window.location.href=\'/estaciones/' + ${esta.get(12).getIdEstacion()} + '\';'">
                <img th:src="@{${estaciones.get(12).getIcono()}}" alt="climaicono" class="weather-icon">
                <label th:text="${esta.get(12).getTemperatura()}"></label></div>
            <div class="passenger-info"  th:onclick="'window.location.href=\'/estaciones/' + ${esta.get(12).getIdEstacion()} + '\';'">
                <div class="passenger-icon"><svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#787F6C"><path d="m40-240 240-320 180 240h300L560-586 460-454l-50-66 150-200 360 480H40Zm521-80Zm-361 0h160l-80-107-80 107Zm0 0h160-160Z"/></svg></div>
                <label th:text="${esta.get(12).getNroZonasTuristicas()}"></label></div>

            <div class="passenger-info"> <br><br>
                <button onclick="eleccion(12)" > Elegir destino </button>
            </div>
        </div>
        <div class="station-card"   >
            <div class="station-name"  th:onclick="'window.location.href=\'/estaciones/' + ${esta.get(13).getIdEstacion()} + '\';'"><label th:text="${esta.get(13).getNombre()}"></label>
                <img class="ubi-tren"  id="u14" th:src="@{/icons/iconos/circulo2.svg}" width="12" height="12" alt="detalleIcon"></div>
            <div class="weather-info"  id="t13" th:onclick="'window.location.href=\'/estaciones/' + ${esta.get(13).getIdEstacion()} + '\';'">
                <img th:src="@{${estaciones.get(13).getIcono()}}" alt="climaicono" class="weather-icon">
                <label th:text="${esta.get(13).getTemperatura()}"></label></div>
            <div class="passenger-info"  th:onclick="'window.location.href=\'/estaciones/' + ${esta.get(13).getIdEstacion()} + '\';'">
                <div class="passenger-icon"><svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#787F6C"><path d="m40-240 240-320 180 240h300L560-586 460-454l-50-66 150-200 360 480H40Zm521-80Zm-361 0h160l-80-107-80 107Zm0 0h160-160Z"/></svg></div>
                <label th:text="${esta.get(13).getNroZonasTuristicas()}"></label></div>

            <div class="passenger-info"> <br><br>
                <button onclick="eleccion(13)" > Elegir destino </button>
            </div>
        </div>
    </div>





    <!-- Tarjeta de elección (inicialmente oculta) -->
    <div id="eleccion-card" class="eleccion-card">
        <button class="close-btn" onclick="cerrarEleccion()">×</button>
        <button id="btnPDF" onclick="descargarPDF()"> Exportar a PDF </button>
        <div id="areaPDF" style="width: 400px; height: 300px;">
            <div class="card-content">
                <label id="card-label" class="card-label">  texto en el js ->>> </label>
                <span class="pasaje">Estación origen: </span> <label id="esta_o" >casa</label> <br><br>
                <span class="pasaje">Pasaje: </span>  S/1.50  <br><br>
                <span class="pasaje">El tren pasará dentro de:  </span>  <label id="esta_t1" >no data</label>  <br><br>
                <span class="pasaje">Tiempo aprox. del viaje:  </span><label id="esta_t2" >no data</label> <br><br>
                <span class="pasaje" id="esta_t3" style="display: none; color: darkred">¡ Luvia fuerte , tener precaución !</span> <br>

                <img  alt="a" id="pie-fondo-emergente" th:src="@{/img/fondoE.jpg}" height="110" width="400"  >
            </div>
        </div>
    </div>

    <div  class="eleccion-card2"  id="ssp" >
        <div ><span class="pasaje">NO HAY TREN </span></div>
    </div>


    <br><br><br>

</div>

<script th:inline="javascript">
    const estaciones = /*[[${esta}]]*/ [];
    const horas = /*[[${horas}]]*/ [];
    const zonas = /*[[${zonas}]]*/ [];
    let ye = 'no';
    let ubi=0;let ubia=0;let nume=0;

    // Función para parsear string de tiempo incluyendo segundos
    function parseTimeString(timeStr) {
        const [hours, minutes, seconds = 0] = timeStr.split(':').map(Number);
        const date = new Date();
        date.setHours(hours, minutes, seconds, 0);
        return date;
    }

    function mostrarTren() {
        ye='no'
        for (let i = 1; i < horas.length; i++) {
            try {
                const t1 = parseTimeString(horas[i].hora);
                const t2 = new Date(); // Hora actual con segundos
                const tAnterior = parseTimeString(horas[i-1].hora);

                if (tAnterior.getTime() <= t2.getTime() && t1.getTime() >= t2.getTime()) {

                    ubi = horas[i-1].estacionUbi;
                    let direc = horas[i-1].direccion;
                    let estad = horas[i-1].estado;

                    if(ubia !== 0) {
                        document.getElementById(ubia.toString()).src = "/icons/iconos/circulo.svg";
                        document.getElementById(ubia.toString()).style.width = "50px";
                        document.getElementById(ubia.toString()).style.height = "50px";
                        document.getElementById(ubia.toString()).style.transform = "none"; // Resetear transformación
                        document.getElementById("u"+ubia.toString()).style.display = "none";
                    }

                    if(estad === 2) {
                        document.getElementById(ubi.toString()).src = "/icons/iconos/trensito2.svg";
                    } else {
                        document.getElementById(ubi.toString()).src = "/icons/iconos/trensito.svg";
                    }
                    if(direc === 2) {
                        document.getElementById(ubi.toString()).style.transform = "scaleX(-1)";
                    } else {
                        document.getElementById(ubi.toString()).style.transform = "none";
                    }
                    document.getElementById(ubi.toString()).style.width = "100px";
                    document.getElementById(ubi.toString()).style.height = "100px";
                    document.getElementById("u"+ubi.toString()).style.display = "block";
                    ubia = ubi;
                    ye='yes'
                    break;
                }
            } catch (error) {
                ubi=ubi;
            }
        }
        if(ye === 'no') {
            document.getElementById('ssp').style.display = 'block';
        }
    }
    function formatTiempo(segundos) {
        if (segundos < 60) {
            return `${segundos} sec`;
        } else if (segundos < 3600) {
            const min = Math.floor(segundos / 60);
            const sec = segundos % 60;
            return `${min} min   ${sec}sec`;
        } else {
            const hrs = Math.floor(segundos / 3600);
            const min = Math.floor((segundos % 3600) / 60);
            return `${hrs} h   ${min}min`;
        }
    }
    // function pdf(){
    //
    // }

    function t(ubi) {
        const des = ubi+1; // estación destino
        const ori = /*[[${ubiPerson}]]*/ 3;  // estación origen
        document.getElementById('esta_o').textContent = `${estaciones[ori-1].nombre}`;
        let direc = 2;
        const now = new Date();
        let abor = null;
        let tf = null;

        if (des > ori) direc = 1;

        for (const ht of horas) {
            const horat = parseTimeString(ht.hora); // 'HH:mm'
            const ubi = ht.estacionUbi;
            const dic = ht.direccion;
            const est = ht.estado;

            if (horat > now && ori === ubi && dic === direc && est === 1) {
                abor = horat;
            }

            if (abor && ubi === des && est === 1) {
                tf = horat;
                const durAbordaje = Math.floor((abor - now) / 1000);
                const durViaje = Math.floor((tf - abor) / 1000);
                document.getElementById('esta_t1').textContent = formatTiempo(durAbordaje);
                document.getElementById('esta_t2').textContent = formatTiempo(durViaje);
                if(estaciones[des-1].intensidad >3){
                    document.getElementById('esta_t3').style.display = 'block';
                }else{
                    document.getElementById('esta_t3').style.display = 'none';
                }

                document.getElementById('pie-fondo-emergente').src = "/img/fondoE.jpg";
                return;
            }
        }
    }
    function eleccion(numero) {
        const card = document.getElementById('eleccion-card');
        const label = document.getElementById('card-label');
        nume= numero;
        t(numero);
        // Actualizar el contenido del label con el número recibido
        label.textContent = `Estación Destino :  ${estaciones[numero].nombre}`;// mandar estacion[numero].nombre o algo asi

        // Mostrar la tarjeta
        card.style.display = 'block';
    }

    // Función para cerrar la tarjeta (solo con X)
    function cerrarEleccion() {
        const card = document.getElementById('eleccion-card');
        card.style.display = 'none';
    }


    // Generar botones al cargar la página
    document.addEventListener('DOMContentLoaded', function() {
        setInterval(mostrarTren, 5000);
        setTimeout(mostrarTren, 0);

        const estaUbi = /*[[${ubiPerson}]]*/ 3; // Thymeleaf reemplaza esto con el número real
        const person = document.getElementById("personIcon");
        const ref = document.getElementById(estaUbi);
        const conte = document.querySelector(".conte");

        function updatePosition() {
            if (!ref || !person || !conte) return;

            const refRect = ref.getBoundingClientRect();
            const conteRect = conte.getBoundingClientRect();

            const left = refRect.left - conteRect.left + (ref.offsetWidth / 2) - (person.offsetWidth / 2);
            const top = refRect.top - conteRect.top + ref.offsetHeight + 5; // justo debajo + margen

            person.style.left = left + "px";
            person.style.top = -10 + "px";
        }

        // Actualiza constantemente (ideal si hay movimiento o animaciones)
        setInterval(updatePosition, 16); // 60 FPS (~16ms)
    });

    async function descargarPDF() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        const nume = 13;

        // Obtener el contenido
        const contenido = document.getElementById("areaPDF").innerText;
        const conte = document.getElementById("t"+nume.toString());

        const originalStyle = conte.getAttribute("stylepagina")

        conte.style.transform = "scale(2)";
        conte.style.transformOrigin = "top left";
        conte.style.margin = "20px";
        conte.style.backgroundColor = "white";
        conte.style.padding = "10px";
        conte.style.fontSize = "2rem";

        // conte.
        const canvas = await html2canvas(conte, {
            scale: 1, // duplica resolución
            useCORS: true
        });

        // ✅ Restauramos estilo original
        if (originalStyle !== null) {
            conte.setAttribute("style", originalStyle);
        } else {
            conte.removeAttribute("style");
        }

        const imgData = canvas.toDataURL("image/png");
        const conte2 = document.getElementById("pie-fondo-emergente");
        const canvas2 = await html2canvas(conte2);
        const imgData2 = canvas2.toDataURL("image/png");

        // Agregar al PDF
        doc.text(contenido, 10, 20);
        doc.text("Clima y temperatura de la estacion destino :", 10, 80);
        // doc.addImage(imgData, 'PNG', 10, 104, 100, 100);
        doc.addImage(imgData, 'PNG', 10, 100, 40, 15);
        doc.addImage(imgData2, 'PNG', 10, 120);
        // Guardar
        doc.save("informe.pdf");
    }
</script>

<br><br><br>

<!--filtros-->

<div class="floating-filters">
    <form method="post" th:object="${filtros}" action="/estaciones/filtrar-zonas/1" class="floating-filters-row">
        <div class="section-block">
            <span class="mensajito">Los filtros se aplican por estación. Si selecciona otra estación, debería seleccionar los filtros otra vez. Si no tiene ninguna estación seleccionada, y presiona el filtro, automáticamente se filtrarán las zonas de la estación 1 Los Postes.</span>
            <span class="section-title">Actividades</span>
            <div class="chip-checkbox-group">
                <div class="chip-item">
                    <input type="checkbox" id="caminata" th:field="*{caminata}">
                    <label for="caminata">Caminata</label>
                </div>
                <div class="chip-item">
                    <input type="checkbox" id="senderismo" th:field="*{senderismo}">
                    <label for="senderismo">Senderismo</label>
                </div>
                <div class="chip-item">
                    <input type="checkbox" id="escalar" th:field="*{escalar}">
                    <label for="escalar">Escalar</label>
                </div>
                <div class="chip-item">
                    <input type="checkbox" id="aventura" th:field="*{aventura}">
                    <label for="aventura">Aventura</label>
                </div>
                <div class="chip-item">
                    <input type="checkbox" id="cultural" th:field="*{cultural}">
                    <label for="cultural">T. Cultural</label>
                </div>
                <div class="chip-item">
                    <input type="checkbox" id="surfear" th:field="*{surfear}">
                    <label for="surfear">Surfear</label>
                </div>
                <div class="chip-item">
                    <input type="checkbox" id="cata" th:field="*{cataVinos}">
                    <label for="cata">Cata de vinos</label>
                </div>
                <div class="chip-item">
                    <input type="checkbox" id="recreativo" th:field="*{recreativo}">
                    <label for="recreativo">T. Recreativo</label>
                </div>
            </div>
        </div>
        <div class="section-block">
            <span class="mensajito"><br><br></span>
            <span class="section-title">Clima</span>
            <div class="chip-checkbox-group">
                <div class="chip-item">
                    <input type="checkbox" id="soleado" th:field="*{soleado}">
                    <label for="soleado">Soleado</label>
                </div>
                <div class="chip-item">
                    <input type="checkbox" id="nublado" th:field="*{nublado}">
                    <label for="nublado">Nublado</label>
                </div>
                <div class="chip-item">
                    <input type="checkbox" id="lluviaLigera" th:field="*{lluviaLigera}">
                    <label for="lluviaLigera">Lluvia ligera</label>
                </div>
            </div>
        </div>

        <div class="section-block boton-block">
            <button type="submit" class="boton">
                <svg xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 -960 960 960" width="20px" >
                    <path d="M440-160q-17 0-28.5-11.5T400-200v-240L168-736q-15-20-4.5-42t36.5-22h560q26 0 36.5 22t-4.5 42L560-440v240q0 17-11.5 28.5T520-160h-80Zm40-308 198-252H282l198 252Zm0 0Z"/>
                </svg>
            </button>
        </div>
    </form>
</div>



<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

</body>
</html>